const VALUE_OF_KEYS = {

    /* -------- first row (highest) -------- */

    Backquote: {
        eng: '`',
        engH: '~',
        rus: 'ё',
        rusH: 'Ё',
    },
    Digit1: {
        eng: '1',
        engH: '!',
        rus: '1',
        rusH: '!',
    },
    Digit2: {
        eng: '2',
        engH: '@',
        rus: '2',
        rusH: '"',
    },
    Digit3: {
        eng: '3',
        engH: '#',
        rus: '3',
        rusH: '#',
    },
    Digit4: {
        eng: '4',
        engH: '$',
        rus: '4',
        rusH: ';',
    },
    Digit5: {
        eng: '5',
        engH: '%',
        rus: '5',
        rusH: '%',
    },
    Digit6: {
        eng: '6',
        engH: '^',
        rus: '6',
        rusH: ':',
    },
    Digit7: {
        eng: '7',
        engH: '&',
        rus: '7',
        rusH: '?',
    },
    Digit8: {
        eng: '8',
        engH: '*',
        rus: '8',
        rusH: '*',
    },
    Digit9: {
        eng: '9',
        engH: '(',
        rus: '9',
        rusH: '(',
    },
    Digit0: {
        eng: '0',
        engH: ')',
        rus: '0',
        rusH: ')',
    },
    Minus: {
        eng: '-',
        engH: '_',
        rus: '-',
        rusH: '_',
    },
    Equal: {
        eng: '=',
        engH: '+',
        rus: '=',
        rusH: '+',
    },
    Equal: {
        eng: '=',
        engH: '+',
        rus: '=',
        rusH: '+',
    },

    Backspace: {
        eng: 'Backspace',
        engH: 'Backspace',
        rus: 'Backspace',
        rusH: 'Backspace',
    },

    /* -------- second row (tab qwerty) -------- */

    /*     Tab: {
          eng: '    ',
          engH: '    ',
          rus: '    ',
          rusH: '    ',
        }, */
    KeyQ: {
        eng: 'q',
        engH: 'Q',
        rus: 'й',
        rusH: 'Й',
    },
    KeyW: {
        eng: 'w',
        engH: 'W',
        rus: 'ц',
        rusH: 'Ц',
    },
    KeyE: {
        eng: 'e',
        engH: 'E',
        rus: 'у',
        rusH: 'У',
    },
    KeyR: {
        eng: 'r',
        engH: 'R',
        rus: 'к',
        rusH: 'К',
    },
    KeyT: {
        eng: 't',
        engH: 'T',
        rus: 'е',
        rusH: 'Е',
    },
    KeyY: {
        eng: 'y',
        engH: 'Y',
        rus: 'н',
        rusH: 'Н',
    },
    KeyU: {
        eng: 'u',
        engH: 'U',
        rus: 'г',
        rusH: 'Г',
    },
    KeyI: {
        eng: 'i',
        engH: 'I',
        rus: 'ш',
        rusH: 'Ш',
    },
    KeyO: {
        eng: 'o',
        engH: 'O',
        rus: 'щ',
        rusH: 'Щ',
    },
    KeyP: {
        eng: 'p',
        engH: 'P',
        rus: 'з',
        rusH: 'З',
    },
    BracketLeft: {
        eng: '[',
        engH: '{',
        rus: 'х',
        rusH: 'Х',
    },
    BracketRight: {
        eng: ']',
        engH: '}',
        rus: 'ъ',
        rusH: 'Ъ',
    },
    Backslash: {
        eng: '\\',
        engH: '|',
        rus: '\\',
        rusH: '/',
    },

    /* -------- third row (Caps asdfgh) -------- */
    /*   CapsLock: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      }, */
    KeyA: {
        eng: 'a',
        engH: 'A',
        rus: 'ф',
        rusH: 'Ф',
    },
    KeyS: {
        eng: 's',
        engH: 'S',
        rus: 'ы',
        rusH: 'Ы',
    },
    KeyD: {
        eng: 'd',
        engH: 'D',
        rus: 'в',
        rusH: 'В',
    },
    KeyF: {
        eng: 'f',
        engH: 'F',
        rus: 'а',
        rusH: 'А',
    },
    KeyG: {
        eng: 'g',
        engH: 'G',
        rus: 'п',
        rusH: 'П',
    },
    KeyH: {
        eng: 'h',
        engH: 'H',
        rus: 'р',
        rusH: 'Р',
    },
    KeyJ: {
        eng: 'j',
        engH: 'J',
        rus: 'о',
        rusH: 'О',
    },
    KeyK: {
        eng: 'k',
        engH: 'K',
        rus: 'л',
        rusH: 'Л',
    },
    KeyL: {
        eng: 'l',
        engH: 'L',
        rus: 'д',
        rusH: 'Д',
    },
    KeyL: {
        eng: 'l',
        engH: 'L',
        rus: 'д',
        rusH: 'Д',
    },
    Semicolon: {
        eng: ';',
        engH: ':',
        rus: 'ж',
        rusH: 'Ж',
    },
    Quote: {
        eng: '\'',
        engH: '"',
        rus: 'э',
        rusH: 'Э',
    },
    /*   Enter: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      } */
    /* -------- fourth row (l-shift zxcvbn) -------- */
    ShiftLeft: {
        eng: 'ShiftLeft',
        engH: 'ShiftLeft',
        rus: 'ShiftLeft',
        rusH: 'ShiftLeft',
    },
    KeyZ: {
        eng: 'z',
        engH: 'Z',
        rus: 'я',
        rusH: 'Я',
    },
    KeyX: {
        eng: 'x',
        engH: 'X',
        rus: 'ч',
        rusH: 'Ч',
    },
    keyC: {
        eng: 'c',
        engH: 'C',
        rus: 'с',
        rusH: 'С',
    },
    KeyV: {
        eng: 'v',
        engH: 'V',
        rus: 'м',
        rusH: 'М',
    },
    KeyB: {
        eng: 'b',
        engH: 'B',
        rus: 'и',
        rusH: 'И',
    },
    KeyN: {
        eng: 'n',
        engH: 'N',
        rus: 'т',
        rusH: 'Т',
    },
    KeyM: {
        eng: 'm',
        engH: 'M',
        rus: 'ь',
        rusH: 'Ь',
    },
    Comma: {
        eng: ',',
        engH: '<',
        rus: 'б',
        rusH: 'Б',
    },
    Period: {
        eng: '.',
        engH: '>',
        rus: 'ю',
        rusH: 'Ю',
    },
    Slash: {
        eng: '/',
        engH: '?',
        rus: '.',
        rusH: ',',
    },
    ShiftRight: {
        eng: 'ShiftRight',
        engH: 'ShiftRight',
        rus: 'ShiftRight',
        rusH: 'ShiftRight',
    },

    /* -------- fifth row (bottom row) -------- */
    /*   ControlLeft: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      },
      MetaLeft: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      },
      AltLeft: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      },
      Space: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      },
      AltRight: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      },
      ArrowLeft: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      },
      ArrowUp: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      },
      ArrowDown: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      },
      ArrowRight: {
        eng: '',
        engH: '',
        rus: '',
        rusH: '',
      }, */
}

document.querySelector('body').innerHTML = "<div class='keyboard-block'><textarea id='text' cllass='text'></textarea><div class='keyboard'></div></div><div class='language'><select class='lenguage-select'><option>eng</option><option>rus</option></div>";

let lang = "eng";
let shiftEnable = false;
/*lang select */
document.querySelector("body > div.language > select").addEventListener('change', (event) => {
    lang = document.querySelector("body > div.language > select").value;
    virtualKeyboard(lang);
});


/*create*/

function virtualKeyboard(type) {

    document.querySelector('.keyboard').innerHTML = "";

    for (element in VALUE_OF_KEYS) {
        let node = document.createElement("div");
        if (shiftEnable == false) {
            node.innerHTML = VALUE_OF_KEYS[element][type];
        } else {
            node.innerHTML = VALUE_OF_KEYS[element][type + "H"];
        }

        node.classList.add('key');
        node.classList.add(element);
        node.setAttribute("id", element);
        document.querySelector('.keyboard').appendChild(node);
        //String.fromCharCode
    }

}
/*key press check */
function check(id) {
    if (VALUE_OF_KEYS[id]) return true;
    //if (alphabet.includes(event.toElement.innerText)) return true;
}



/*key function */
function keyDo(id, lang) {

    let text = document.getElementById("text").value.split("");
    let start = document.getElementById("text").selectionStart;
    let end = document.getElementById("text").selectionEnd;

    let str = document.getElementById("text").value;

    let char = '';
    if (shiftEnable === true) {
        char = VALUE_OF_KEYS[id][lang + "H"];
    } else {
        char = VALUE_OF_KEYS[id][lang];
    }
    if (id === "Backspace" || id === "ShiftLeft" || id === "ShiftRight") {
        if (id === "Backspace") {
            backspace(text, start, end, str);

        }
        if (id === "ShiftLeft" || id === "ShiftRight") {
            shiftEnable = true;
            virtualKeyboard(lang);
        }
    } else {
        rebuildChar(str, start, end, char);
        //document.getElementById("text").value += selectKey(id, lang);
    }
}


/*leng and all key*/
function selectKey(id, lang) {

    //rebuildChar(str, start, end, char);

    //rebuild(str, start, end);
    return VALUE_OF_KEYS[id][lang];
}


/**backspace */
function backspace(text, start, end, str) {;


    //if(document.getElementById("text").selectionStart == 0 & document.getElementById("text").value.length != 0)

    rebuildBackspace(str, start, end);
    // document.getElementById("text").value = "";
    // document.getElementById("text").value += rebuild(str, start, end).first;
    // document.getElementById("text").value += rebuild(str, start, end).last;


    // return str;

};

/*rebuild backspace*/
function rebuildBackspace(str, start, end) {
    let first = '';
    let last = '';
    if (start === 0) {
        return str
    } else {
        if (start != end) {
            first = str.slice(0, start);
            last = str.slice(end, str.length);
            document.getElementById("text").value = "";
            document.getElementById("text").value += first;
            document.getElementById("text").value += last;
            document.getElementById("text").selectionStart = start;
            document.getElementById("text").selectionEnd = start;
            //return { first: first, last: last };
        } else {
            first = str.slice(0, start - 1);
            last = str.slice(end, str.length);
            document.getElementById("text").value = "";
            document.getElementById("text").value += first;
            document.getElementById("text").value += last;
            document.getElementById("text").selectionStart = start - 1;
            document.getElementById("text").selectionEnd = start - 1;

            //return { first: first, last: last };
        }


    }
}

/*rebuild Char*/
function rebuildChar(str, start, end, char) {
    let first = '';
    let last = '';
    if (start === str.length) {
        document.getElementById("text").value += char;
        document.getElementById("text").selectionStart = start + 1;
        document.getElementById("text").selectionEnd = start + 1;
        //return str
    } else {
        if (start != end) {
            first = str.slice(0, start);
            last = str.slice(end, str.length);
            document.getElementById("text").value = "";
            document.getElementById("text").value += first;
            document.getElementById("text").value += char;
            document.getElementById("text").value += last;
            document.getElementById("text").selectionStart = start + 1;
            document.getElementById("text").selectionEnd = start + 1;
            //return { first: first, last: last };
        } else {

            first = str.slice(0, start);
            last = str.slice(end, str.length);
            document.getElementById("text").value = "";
            document.getElementById("text").value += first;
            document.getElementById("text").value += char;
            document.getElementById("text").value += last;
            document.getElementById("text").selectionStart = start + 1;
            document.getElementById("text").selectionEnd = start + 1;
            console.log(document.getElementById("text").selectionEnd, document.getElementById("text").selectionStart);
            //return { first: first, last: last };
        }


    }
}

/*display input*/
document.querySelector(".keyboard").addEventListener('click', (event) => {

    if (check(event.target.id)) {
        if (event.target.id === "ShiftLeft" || event.target.id === "ShiftRight") {
            if (shiftEnable === false) {
                shiftEnable = true;
            } else {
                shiftEnable = false;
            }
            virtualKeyboard(lang, shiftEnable);
        } else {
            keyDo(event.target.id, lang, shiftEnable);
        }



    }
});

/*key input keydown*/
document.addEventListener('keydown', function(event) {
    event.preventDefault();
    if (check(event.code)) {
        keyDo(event.code, lang);

        document.querySelectorAll(".key").forEach((element) => {
            if (element.id == event.code) {
                element.classList.add('presed');
            }


        })

        // if (event.code === "ShiftLeft" || event.code === "ShiftRight") {
        //     shiftEnable == true;
        //      virtualKeyboard(lang, shiftEnable);
        // }
    }
});

/*key up clean hover */

document.addEventListener('keyup', function(event) {
    if (check(event.code)) {
        document.querySelectorAll(".key").forEach((element) => {
            if (element.id == event.code) {
                element.classList.remove('presed');

            }


        })
        if (event.code === 'ShiftLeft' || event.code === 'ShiftRight') {
            shiftEnable = false;
            virtualKeyboard(lang);
        }
    }
});

virtualKeyboard(lang);